<ui:composition template="/pages/inc/template.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://java.sun.com/jsf/core">

	<ui:define name="header" />

	<ui:define name="content">
	
	<style>
    		#pesquisarItens table tbody tr td { padding: 0px 10px 0px 0px !important; vertical-align: bottom; }
			#pesquisarItens table tbody tr td select, #boxInfosMarca table tbody tr td input[type=text] { margin-top: 8px; }
			#pesquisarItens table tbody tr td .btn{ }
			.hasDatepicker {
				line-height:normal !important; 
				width: 210px !important; 
				height: 25px !important;
				background-color:#E9E9E9 !important;
			}
		</style>	
		
		<div class="grid_24">
		
			<h1>Detalhe do Pedido</h1>
			
			<h:form>

				<p:panel header="Informações pedido">
					<h:panelGrid columns="4" >
						<h:outputText value="Número do pedido: "/>
                        <p:inputText value="#{pedidoController.pedidoDetalhe.pedidoCapa.numeroPedido}" disabled="true" style="width: 150px;font-weight:bold;" />
                        
						<h:outputText value="Origem: " />
						<p:inputText value="#{pedidoController.pedidoDetalhe.pedidoCapa.origem}"  disabled="true" style="width: 150px;font-weight:bold;"/>
						
						<h:outputText value="Canal: "/>
						<p:inputText value="#{pedidoController.pedidoDetalhe.pedidoCapa.canal}" disabled="true" style="width: 250px;font-weight:bold;" />
						
						<h:outputText value="Emissão: "/>
						<p:inputText value="#{pedidoController.pedidoDetalhe.pedidoCapa.emissao}" disabled="true" style="width: 150px;font-weight:bold;" ><f:convertDateTime locale="pt_BR" /></p:inputText>
						
						<h:outputText value="Marca: "/>
						<p:inputText value="#{pedidoController.pedidoDetalhe.pedidoCapa.descricaoMarcas}" disabled="true" style="width: 250px;font-weight:bold;" />
						
						<p:spacer /><p:spacer />
						
						<h:outputText value="CNPJ: "/>
						<p:inputText value="#{pedidoController.pedidoDetalhe.pedidoCapa.clienteCnpjFormatado}" disabled="true" style="width: 250px;font-weight:bold;" />
						
						<p:spacer /><p:spacer />
						
						<h:outputText value="Razão Social: "/>
						<p:inputText value="#{pedidoController.pedidoDetalhe.pedidoCapa.clienteRazaoSocial}" disabled="true" style="width: 450px;font-weight:bold;" />
						
						<p:spacer /><p:spacer />
						
						<h:outputText value="Representante: "/>
						<p:inputText value="#{pedidoController.pedidoDetalhe.pedidoCapa.representanteRazaoSocial}" disabled="true" style="width: 450px;font-weight:bold;" />
					</h:panelGrid>
				</p:panel>
				<br />
				<p:fieldset legend="Situação do pedido" toggleable="true" toggleSpeed="500">  
					 <br /> 
	    				<table class="ui-datatable ui-widget" style="width: 100%; text-align: center" role="grid">
	    				<tr class="ui-widget-content ui-datatable-odd">	
								<th class="ui-state-default" />
								<th class="ui-state-default" colspan="4">Produtos</th>
							</tr>
							<tr class="ui-widget-content ui-datatable-odd">	
								<th class="ui-state-default">Totalizado por</th>
								<th class="ui-state-default">Total</th>
								<th class="ui-state-default">Em aberto</th>
								<th class="ui-state-default">Faturado(s)</th>
								<th class="ui-state-default">Cancelado(s)</th>
							</tr>
							<tr  class="ui-widget-content ui-datatable-even">
								<td>Quantidade</td>
								<td><h:outputText value="#{pedidoController.pedidoDetalhe.pedidoCapa.quantidadeSolicitada}"/></td>
								<td><h:outputText value="#{pedidoController.pedidoDetalhe.pedidoCapa.quantidadeAberta}"/></td>
								<td><h:outputText value="#{pedidoController.pedidoDetalhe.pedidoCapa.quantidadeFaturada}"/></td>
								<td><h:outputText value="#{pedidoController.pedidoDetalhe.pedidoCapa.quantidadeCancelada}"/></td>
							</tr>
							<tr class="ui-widget-content ui-datatable-odd">
								<td>Valor</td>
								<td><h:outputText value="#{pedidoController.pedidoDetalhe.pedidoCapa.valorTotalLiquido}"><f:convertNumber locale="pt_BR" type="currency"/></h:outputText></td>
								<td><h:outputText value="#{pedidoController.pedidoDetalhe.pedidoCapa.valorAberto}"><f:convertNumber locale="pt_BR" type="currency"/></h:outputText></td>
								<td><h:outputText value="#{pedidoController.pedidoDetalhe.pedidoCapa.valorFaturado}"><f:convertNumber locale="pt_BR" type="currency"/></h:outputText></td>
								<td><h:outputText value="#{pedidoController.pedidoDetalhe.pedidoCapa.valorCancelado}"><f:convertNumber locale="pt_BR" type="currency"/></h:outputText></td>
							</tr>
						</table>
						<br /> 	
	    			</p:fieldset>
	    				
	    			<br />
	    		
	    			<p:fieldset legend="Itens do pedido (clique e veja todos)" toggleable="true" toggleSpeed="500" collapsed="true">  
    					<p:ajax event="toggle" listener="#{pedidoController.abrirItensDeltalhe}" update="tableItens"/>  
    					
    					<div id="pesquisarItens">
    						<h:panelGrid columns="5" title="Pesquisar">
		    					<p:column>
					    			<h:inputText style="line-height:normal; width: 210px; height: 25px"
					    				value="#{pedidoController.itemPedidoSearchVO.referencia}" id="filtroReferencia" />
					    			<p:watermark value="Referência" for="filtroReferencia" />
					    		</p:column>
					    		
					    		<p:column>
					    			<h:inputText style="line-height:normal; width: 210px; height: 25px"
					    				value="#{pedidoController.itemPedidoSearchVO.descricaoProduto}" id="filtroDescricao" />
					    			<p:watermark value="Nome do Produto" for="filtroDescricao" />
					    		</p:column>
					    		
					    		<p:column>
					    			<p:calendar  locale="pt" showButtonPanel="true" navigator="true"
					    				value="#{pedidoController.itemPedidoSearchVO.dataFaturamento}" id="filtroDataFaturamento" />
					    			<p:watermark value="Data Faturamento" for="filtroDataFaturamento" />
					    		</p:column>
					    		
					    		<p:column>
					    			<h:selectOneMenu style="width: 210px; height: 25px;" panelStyle="width: 265px;" value="#{pedidoController.itemPedidoSearchVO.ordernarPor}">
					    				<f:selectItem itemLabel="Ordenar por referência" itemValue="REFERENCIA" />
					    				<f:selectItem itemLabel="Ordenar por data faturamento" itemValue="DATA_FATURAMENTO" />
					    			</h:selectOneMenu>
					    		</p:column>
					    		
					    		<p:commandButton style="height: 25px" actionListener="#{pedidoController.pesquisarItemPedido}" icon="ui-icon ui-icon-search" title="Pesquisar" 
					    			update="tableItens"/>
					    	</h:panelGrid>
    					</div>
    				
    					<br />
	    				<p:dataTable id="tableItens" var="item" value="#{pedidoController.pedidoDetalhe.itens}" rows="30" lazy="true" paginator="true" emptyMessage="Carregando itens ..."
	    					paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"> 
	    					
	    				 <p:columnGroup type="header">  
				            <p:row>  
				               <p:column colspan="2" headerText="Informações Produtos"/>
				               <p:column colspan="1"  headerText=" "/>
				               <p:column colspan="2" headerText="Valores" />
				                <p:column colspan="1"  headerText="Data"/>
				            </p:row>  
				            <p:row>  
				                <p:column colspan="1"  headerText="Referência"/>
				                <p:column colspan="1"  headerText="Descricao"/>
				                <p:column colspan="1"  headerText="Quantidade"/>
				                <p:column colspan="1"  headerText="Unitário"/>
				                <p:column colspan="1"  headerText="Total"/>
				                <p:column colspan="1"  headerText="Faturamento"/>
				            </p:row> 
				         </p:columnGroup>
	    					 
					   		<p:column>
					   			<h:outputText value="#{item.referencia}"/>
							</p:column >	
							<p:column style="white-space:normal !important; width: 500px">
					   			<h:outputText value="#{item.descricao}"/>
							</p:column>	
							<p:column>
					   			<h:outputText value="#{item.quantidade}"/>
							</p:column>	
							<p:column>
					   			<h:outputText value="#{item.valorUnitario}"><f:convertNumber locale="pt_BR" type="currency"/></h:outputText>
							</p:column>	
							<p:column>
					   			<h:outputText value="#{item.valorTotal}"><f:convertNumber locale="pt_BR" type="currency"/></h:outputText>
							</p:column>	
							<p:column sortBy="#{item.ultimoFaturamento}" >
					   			<h:outputText value="#{item.ultimoFaturamento}"><f:convertDateTime locale="pt_BR" /></h:outputText>
							</p:column>	
							
							<ui:remove>
							<p:columnGroup type="footer">  
					            <p:row>  
					           	   <p:column colspan="2" footerText="Pedido completo" style="text-align:left" />
					               <p:column colspan="1" footerText="Quantitade Total: " style="text-align:right" />
					               <p:column colspan="1" footerText="#{pedidoController.pedidoDetalhe.pedidoCapa.quantidadeSolicitada}"/>
					               <p:column colspan="2" footerText="Valor Total: " style="text-align:right" />
					               <p:column colspan="1" footerText="#{pedidoController.pedidoDetalhe.pedidoCapa.valorTotalFormatado}" /> 
					               <p:column colspan="1"  />
					            </p:row>  
				            </p:columnGroup></ui:remove>
							
				   		 </p:dataTable>	
				   		<br /> 	
				   	</p:fieldset>   	
			<br />
	    				
	    			<p:fieldset legend="Informações de faturamento (clique e veja todos)" toggleable="true" toggleSpeed="500" collapsed="true">  
	    				<p:ajax event="toggle" listener="#{pedidoController.expandFieldSetPedido}" update="panelFaturamento" />  
	    				<br /> 
	    				
	    				<p:outputPanel id="panelFaturamento">
							<p:dataTable id="tableFaturamentos" var="pedido" value="#{pedidoController.pedidoDetalhe.pedidoCapa.faturamentos}" emptyMessage="Pedido não possui faturamento." 
								style="text-align: center">  
					   			<p:column headerText="Nota Fiscal">
					   				<h:outputText value="#{pedido.numeroNf}"/>
							   	</p:column>	
							   	<p:column headerText="Série">
					   				<h:outputText value="#{pedido.serie}"/>
							   	</p:column>	
							   	<p:column headerText="Quantidade de Itens">
							   		<h:outputText value="#{pedido.quantidadeItens}"/>
							   	</p:column>
							   	<p:column headerText="Valor">
							   		<h:outputText value="#{pedido.valorTotal}"><f:convertNumber locale="pt_BR" type="currency"/></h:outputText>
							   	</p:column>
							   	<p:column headerText="Data Faturamento">
					   				<h:outputText value="#{pedido.dataFaturamento}"><f:convertDateTime locale="pt_BR" /></h:outputText>
					   			</p:column>	
				   		 	</p:dataTable>	
			   		 	</p:outputPanel>    
			   		 	<br /> 	
	    			</p:fieldset>
	    				
	    			<br />
	    				
			<p:commandButton value="Voltar" title="Voltar" style="height: 25px" icon="ui-icon-arrowreturnthick-1-w" ajax="false"
				action="/pages/meus-pedidos.xhtml?faces-redirect=true"/> <br /><br />
			</h:form>
		
		</div>
		
		<script>
        	PrimeFaces.locales['pt'] = {  
                closeText: 'Fechar',  
                prevText: 'Anterior',  
                nextText: 'Próximo',  
                currentText: 'Começo',  
                monthNames: ['Janeiro','Fevereiro','Março','Abril','Maio','Junho','Julho','Agosto','Setembro','Outubro','Novembro','Dezembro'],  
                monthNamesShort: ['Jan','Fev','Mar','Abr','Mai','Jun', 'Jul','Ago','Set','Out','Nov','Dez'],  
                dayNames: ['Domingo','Segunda','Terça','Quarta','Quinta','Sexta','Sábado'],  
                dayNamesShort: ['Dom','Seg','Ter','Qua','Qui','Sex','Sáb'],  
                dayNamesMin: ['D','S','T','Q','Q','S','S'],  
                weekHeader: 'Semana',  
                firstDay: 1,  
                isRTL: false,  
                showMonthAfterYear: false,  
                yearSuffix: '',  
                timeOnlyTitle: 'Só Horas',  
                timeText: 'Tempo',  
                hourText: 'Hora',  
                minuteText: 'Minuto',  
                secondText: 'Segundo',  
                currentText: 'Data Atual',  
                ampm: false,  
                month: 'Mês',  
                week: 'Semana',  
                day: 'Dia',  
                allDayText: 'Todo Dia'  
            };  
        </script>
		
	</ui:define>

	<ui:define name="footer" />

</ui:composition>